<div id="page-home">
	<h1 align="center" style="font-family: robotoBlack">Omega Suite</h1>
    <h1 align="center" style="font-family: roboto; font-size: 4em;">Œ©üèÅ</h1>
    <br><br><br><br><br><br><br><br>
	<center><div class="btn-group" role="group">
        <button type="button" class="btn btn-lg btn-default" id="importButton">Import Data</button>
        <button type="button" class="btn btn-lg btn-default" id="openConfigFolderButton">Open Config</button>
        <button type="button" class="btn btn-lg btn-default" onclick="if (confirm('Are you sure?')) {window.location.reload()}">Reload</button>
    </div></center>
</div>

<script type="text/javascript">
	const platform = require('electron-platform');
	var fs = require('fs-extra')
	const AD = require('appdirectory')
	dataDir = new AD("companal-2017-analysis-simple").userData()
	 
    if (!fs.existsSync(`${dataDir}/pit-scouting/manifest.json`)) {
        fs.writeFileSync(`${dataDir}/pit-scouting/manifest.json`, JSON.stringify([]))
    }
    if (!fs.existsSync(`${dataDir}/stand-scouting/manifest.json`)) {
        fs.writeFileSync(`${dataDir}/stand-scouting/manifest.json`, JSON.stringify([]))
    }

    $("#openConfigFolderButton").click(function () {
        console.log(dataDir)
        var exec = require('child_process').exec
        var cmd = `open "${dataDir}"`
        exec(cmd, function(error, stdout, stderr) {});
    })
     
	$("#importButton").click(function() {
		var flashDir
		if (platform.isDarwin)
			flashDir = '/Volumes/1540/companal'
		else if (platform.isWin32)
			flashDir = 'R:/companal'
        if (!fs.existsSync(flashDir)) {
            alert("Wait for flashdrive...")
            return
        }
        var newPitManifest = JSON.parse(fs.readFileSync(`${flashDir}/output/pit-scouting/manifest.json`, 'utf8'))
        var currentPitManifest = JSON.parse(fs.readFileSync(`${dataDir}/pit-scouting/manifest.json`, 'utf8'))
        for (var pitIndex in newPitManifest) {
            var newPitFile = newPitManifest[pitIndex]

            if (!fs.existsSync(`${dataDir}/pit-scouting/${newPitFile}`) && fs.existsSync(`${flashDir}/output/pit-scouting/${newPitFile}`)) {
                fs.copySync(`${flashDir}/output/pit-scouting/${newPitFile}`, `${dataDir}/pit-scouting/${newPitFile}`)
                currentPitManifest.push(newPitFile)
            }
        }
        fs.writeFileSync(`${dataDir}/pit-scouting/manifest.json`, JSON.stringify(currentPitManifest))

        var newStandManifest = JSON.parse(fs.readFileSync(`${flashDir}/output/stand-scouting/manifest.json`, 'utf8'))
        var currentStandManifest = JSON.parse(fs.readFileSync(`${dataDir}/stand-scouting/manifest.json`, 'utf8'))
        for (var standIndex in newStandManifest) {
            var newStandFile = newStandManifest[standIndex]

            if (!fs.existsSync(`${dataDir}/stand-scouting/${newStandFile}`) && fs.existsSync(`${flashDir}/output/stand-scouting/${newPitFile}`)) {
                fs.copySync(`${flashDir}/output/stand-scouting/${newStandFile}`, `${dataDir}/stand-scouting/${newStandFile}`)
                currentStandManifest.push(newStandFile)
            }
        }
        fs.writeFileSync(`${dataDir}/stand-scouting/manifest.json`, JSON.stringify(currentStandManifest))

        fs.copySync(`${flashDir}/output/pit-scouting`, `${dataDir}/pit-scouting`, {overwrite: true})
        fs.copySync(`${flashDir}/output/stand-scouting`, `${dataDir}/stand-scouting`, {overwrite: true})
        fs.copySync(`${flashDir}/output/tournament`, `${dataDir}/tournament`, {overwrite: true})
        if (fs.existsSync(`${flashDir}/output/tournament/matchSchedule.json`)) {
            fs.copySync(`${flashDir}/output/tournament/matchSchedule.json`, `${dataDir}/matchSchedule.json`, {overwrite: true})
        }
        alert("Done!")
        window.location.reload()
    })

	var standRecords = {}
	var pitRecords = {}
    var pitManifest = JSON.parse(fs.readFileSync(`${dataDir}/pit-scouting/manifest.json`, 'utf8'))
    var standManifest = JSON.parse(fs.readFileSync(`${dataDir}/stand-scouting/manifest.json`, 'utf8'))
    for (var i in pitManifest) {
    	var filename = pitManifest[i]
    	var team = filename.split('.')[0]
        if (fs.existsSync(`${dataDir}/pit-scouting/${filename}`)) {
            pitRecords[team] = JSON.parse(fs.readFileSync(`${dataDir}/pit-scouting/${filename}`, 'utf8'))
        }
    	
    }
    for (var j in standManifest) {
    	var filename = standManifest[j]
    	var team = filename.split('-')[2].split('.')[0]
    	if (!standRecords.hasOwnProperty(team)) {
    		standRecords[team] = []
    	}
        if (fs.existsSync(`${dataDir}/stand-scouting/${filename}`))
    	   standRecords[team].push(JSON.parse(fs.readFileSync(`${dataDir}/stand-scouting/${filename}`, 'utf8')))
    }



</script>